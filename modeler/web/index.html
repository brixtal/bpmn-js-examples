<html>
<head>
  <title>bpmn-js modeler demo</title>

  <link rel="stylesheet" href="css/diagram-js.css" />
  <link rel="stylesheet" href="vendor/bpmn-font/css/bpmn-embedded.css" />
  <link rel="stylesheet" href="css/app.css" />
  <link rel="stylesheet" href="css/jquery.contextMenu.css" />
  
  
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
 <script src="./jquery.contextMenu.js"></script>
 <script src="./bpmnt.js"></script>

    
</head>
<body>
  <div class="content" id="js-drop-zone">

    <div class="message intro">
      <div class="note">
		Drop BPMN diagram from your desktop or <a id="js-create-diagram" href>create a new diagram</a> to get started.
      </div>
    </div>

    <div class="message error">
      <div class="note">
        <p>Ooops, we could not display the BPMN 2.0 diagram.</p>

        <div class="details">
          <span>cause of the problem</span>
          <pre></pre>
        </div>
      </div>
    </div>

    <div class="canvas" id="js-canvas"></div>
  </div>

  <ul class="buttons">
    <li>
      download
    </li>
    <li>
      <a id="js-download-diagram" href title="download BPMN diagram">
        BPMN diagram
      </a>
    </li>
    <li>
      <a id="js-download-svg" href title="download as SVG image">
        SVG image
      </a>
    </li>
  </ul>

  <script>

var parser = new DOMParser();

var bpmnXml = parser.parseFromString(decodeURIComponent(sessionStorage.bpmn), 'text/xml');



function createSequenceFlow() {
  var sequenceFlowElement = 'SequenceFlow_' + Math.random().toString().replace('0.','');
  return sequenceFlowElement;
}

$(function() {
        $.contextMenu({
            selector: '.djs-element', 
            callback: function(key, options) {
                var m = key + " on " + $(this).attr("data-element-id");
        var action, selectedElement;
        window.console && console.log(m); 
        if(key == "insert-s"){
           selectedElement = $(this).attr("data-element-id");
           var elementXml = bpmnXml.getElementById(selectedElement);
                
           
           var outgoingSequenceFlow = elementXml.getElementsByTagName('bpmn2:outgoing')[0].innerHTML;
           console.log(outgoingSequenceFlow);           
           var newOutgoingSequenceFlow = createSequenceFlowId();
           elementXml.getElementsByTagName('bpmn2:outgoing')[0].innerHTML = newOutgoingSequenceFlow;
           var newTask = createTask(newOutgoingSequenceFlow, outgoingSequenceFlow);
           var newSequenceFlow = createSequenceFlowTag(newOutgoingSequenceFlow, selectedElement, newTask.id);
           bpmnXml.getElementsByTagName('bpmn2:process')[0].appendChild(newSequenceFlow);
           bpmnXml.getElementsByTagName('bpmn2:process')[0].appendChild(newTask);
           console.log(bpmnXml);
        }

        
        if(key == "insert-c"){
          /*action = $('div[data-action="append.gateway"]');
          action.trigger("click");
          var gateway = $('.selected');
          
          action = $('div[data-action="append.append-task"]');
          alert (gateway.attr("data-element-id"));
          action.trigger("click");
          gateway.trigger("focus");
          gateway.trigger("hover");
          action = $('div[data-action="append.append-task"]');    */



          location.reload();    
        }
        if(key == "delete") {
          action = $('div[data-action="delete"]');
        }
        //action.trigger("click");
        //alert(teste);
            },
            items: {
                "extend": {name: "Extend"},
                "delete": {name: "Delete"},
                "replace": {name: "Replace"},
                "move": {name: "Move"},
                "paralellize": {name: "Paralellize"},
                "encapsulate": {name: "Encapsulate"},
        "split": {name: "Split"},
        "merge": {name: "Merge"},
        "rename": {name: "Rename"},
        "fold1": {
          "name":"Exception",
          "items": {
            "exception-h": {name: "Handler"},
            "exception-f": {name: "Flow"},
          }
        },
        "fold2": {
          "name":"Insert",
          "items": {
            "insert-s": {name: "Serial"},
            "insert-c": {name: "Conditional"},
            "insert-e": {name: "Event-based"}
          }
        }   
            }
        });

        $('.context-menu-one').on('click', function(e){
            console.log('clicked', this);
        })    
    });

    

</script>

  <script src="index.js"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://swisnl.github.io/jQuery-contextMenu/dist/jquery.contextMenu.js" type="text/javascript"></script>

    <script src="https://swisnl.github.io/jQuery-contextMenu/dist/jquery.ui.position.min.js" type="text/javascript"></script>

    <script src="https://swisnl.github.io/jQuery-contextMenu/js/main.js" type="text/javascript"></script>
</html>
